<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="shop.demo.mapper.EvaluateMapper">
    <insert id="addEvaluate">
        insert into evaluate(account, orderId, goodsId, goodsSpecsId, rate, comment) values(#{account}, #{orderId},
        #{goodsId}, #{goodsSpecsId},
        #{rate}, #{comment});
    </insert>

    <select id="selEvaluate" resultType="shop.demo.entity.Evaluate">
        select id, account, orderId, goodsId, rate, comment, createdAt, updatedAt from evaluate where account =
        #{account} and orderId = #{orderId}
        <if test="goodsId != ''">and goodsId = #{goodsId}</if>
        <if test="goodsSpecsId != ''">and goodsSpecsId = #{goodsSpecsId}</if>;
    </select>

    <select id="selGoodsEvaluateList" resultType="map">
        select e.id, e.account, e.orderId, e.goodsId, e.rate, e.comment, e.createdAt, e.updatedAt, u.avatar, u.name
        from evaluate e, user u
        where goodsId = #{goodsId} and e.account = u.account
        <if test="type == 3">
            and rate &lt;= 4
        </if>
        <if test="type == 2">
            and rate &gt;= 5 and rate &lt;= 7
        </if>
        <if test="type == 1">
            and rate &gt;= 8 and rate &gt;= 10
        </if>
        order by e.createdAt desc;
    </select>

    <select id="goodsEvaluateListCount" resultType="Integer">
        select count(*) from evaluate where goodsId = #{goodsId};
    </select>
</mapper>