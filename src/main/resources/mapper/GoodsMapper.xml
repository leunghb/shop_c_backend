<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="shop.demo.mapper.GoodsMapper">
    <select id="getGoodsType" resultType="shop.demo.entity.GoodsType" parameterType="shop.demo.entity.GoodsType">
        select id,title,priority,icon,soldOut,createdAt,updatedAt from goods_type where soldOut = #{soldOut};
    </select>

    <delete id="delGoodsType">
        delete from goods_type where id = #{id}
    </delete>

    <insert id="addGoodsType">
        insert into goods_type (title, soldOut, priority, icon) values (#{title}, #{soldOut}, #{priority}, #{icon});
    </insert>

    <update id="putGoodsType">
        update goods_type set title = #{title}, soldOut = #{soldOut} , priority = #{priority}, icon = #{icon} where id = #{id} limit 1;
    </update>

    <select id="getCountWhereSomething" resultType="Integer">
        select count(*) from goods
        <where>
            <if test="soldOut >= 0">
                soldOut = #{soldOut}
            </if>
            <if test="goodsTypeId > 0">
                and goodsTypeId = #{goodsTypeId}
            </if>
            <if test="mainTitle != ''">
                and mainTitle like '%' #{mainTitle} '%'
            </if>
        </where>
    </select>

    <select id="getGoodsList" resultType="shop.demo.entity.Goods">
        select id,goodsId,originalPrice,discountPrice,cover,mainTitle,goodsTypeId, createdAt, updatedAt from goods
        <where>
            <if test="soldOut >= 0">
                soldOut = #{soldOut}
            </if>
            <if test="goodsTypeId > 0">
                and goodsTypeId = #{goodsTypeId}
            </if>
            <if test="mainTitle != ''">
                and mainTitle like '%' #{mainTitle} '%'
            </if>
        </where>
        order by createdAt desc
        limit #{limit} offset #{page}
        ;
    </select>

    <select id="hasGoodsOfType" resultType="Integer">
        select count(*) from goods where goodsTypeId = #{id} and soldOut = 0;
    </select>

    <select id="getHotGoods" resultType="shop.demo.entity.Goods">
        select id,goodsId,mainTitle,salesVolume,cover from goods order by salesVolume desc, createdAt desc limit #{num};
    </select>

    <select id="getGoodsDetail" resultType="shop.demo.entity.Goods">
        select
        id,goodsId,goodsTypeId,originalPrice,discountPrice,cover,mainTitle,subTitle,salesVolume,soldOut,stock,content,specList
        from goods where goodsId = #{goodsId};
    </select>

    <update id="putGoodsStock">
        update goods set stock = stock - #{stock} where goodsId = #{goodsId} limit 1;
    </update>

    <update id="putGoodsSalesVolume">
        update goods set salesVolume = salesVolume + #{number} where goodsId = #{goodsId} limit 1;
    </update>

    <insert id="addGoods">
        insert into goods
        (goodsId, goodsTypeId, originalPrice, discountPrice, cover, mainTitle, subTitle, soldOut, stock, content, specList)
        values (#{goodsId}, #{goodsTypeId}, #{originalPrice}, #{discountPrice}, #{cover}, #{mainTitle}, #{subTitle}, #{soldOut}, #{stock}, #{content}, #{specList})
        on duplicate key update
        goodsTypeId = #{goodsTypeId},
        originalPrice = #{originalPrice},
        discountPrice = #{discountPrice},
        cover = #{cover},
        mainTitle = #{mainTitle},
        subTitle = #{subTitle},
        soldOut = #{soldOut},
        stock = #{stock},
        content = #{content},
        specList = #{specList};
    </insert>

    <delete id="delGoods">
        delete from goods where goodsId = #{goodsId};
    </delete>
</mapper>